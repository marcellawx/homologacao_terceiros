<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protótipo - Central de Contratos de Terceiros</title>
    <style>
        /* --- ESTILOS GLOBAIS E VARIÁVEIS (Reaproveitados) --- */
        :root {
            --cor-primaria: #0072C6;
            --cor-sucesso: #28a745;
            --cor-perigo: #dc3545;
            --cor-aviso: #FFC107;
            --cor-info: #6f42c1; /* Roxo para Aditivo */
            --cor-fundo: #F4F7FC;
            --cor-fundo-coluna: #E9ECEF;
            --cor-texto: #333;
            --cor-borda: #DEE2E6;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--cor-fundo);
            margin: 0;
            padding: 25px;
            color: var(--cor-texto);
        }
        h1 {
            color: var(--cor-primaria);
            text-align: center;
            margin-bottom: 30px;
        }

        /* --- LAYOUT DO KANBAN --- */
        .kanban-board {
            display: flex;
            gap: 20px;
            overflow-x: auto; /* Permite rolar horizontalmente se não couber */
            padding-bottom: 20px;
        }
        .kanban-column {
            flex: 1;
            min-width: 320px;
            background-color: var(--cor-fundo-coluna);
            border-radius: 8px;
            padding: 15px;
        }
        .kanban-column h2 {
            font-size: 18px;
            margin: 0 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--cor-borda);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .task-count {
            background-color: #ced4da;
            color: #495057;
            border-radius: 12px;
            padding: 2px 10px;
            font-size: 14px;
        }

        /* --- ESTILO DOS CARDS --- */
        .kanban-card {
            background-color: #FFF;
            padding: 15px;
            border-radius: 6px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.08);
            border-left: 5px solid; /* A cor será definida pela classe do processo */
            margin-bottom: 15px;
        }
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .card-header h3 {
            font-size: 16px;
            margin: 0;
            color: var(--cor-texto);
        }
        .badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            color: white;
        }
        .badge.homologacao { background-color: var(--cor-primaria); }
        .badge.reajuste { background-color: var(--cor-aviso); color: #333; }
        .badge.aditivo { background-color: var(--cor-info); }
        .badge.desomologacao { background-color: var(--cor-perigo); }

        .card-body p {
            font-size: 14px;
            margin: 5px 0;
            color: #555;
        }
        /* NOVO: Estilo para o link do Zendesk */
        .card-body a {
            color: var(--cor-primaria);
            text-decoration: none;
            font-weight: bold;
        }
        .card-body a:hover {
            text-decoration: underline;
        }

        /* --- CHECKLIST EXPANSÍVEL --- */
        .checklist-container {
            margin-top: 15px;
        }
        .checklist-container summary {
            cursor: pointer;
            font-weight: bold;
            color: var(--cor-primaria);
            font-size: 14px;
        }
        .checklist {
            list-style: none;
            padding: 10px 0 0 5px;
            margin: 0;
        }
        .checklist li {
            font-size: 14px;
            padding: 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #f0f0f0;
        }
        .checklist li:last-child {
            border-bottom: none;
        }
        .task-content {
            display: flex;
            align-items: center;
        }
        .checklist input[type="checkbox"] {
            margin-right: 10px;
            flex-shrink: 0;
        }
        .checklist label {
             line-height: 1.4;
        }
        .checklist label.completed {
            text-decoration: line-through;
            color: #888;
        }
        .checklist-date {
            font-size: 12px;
            color: #6c757d;
            font-style: italic;
            margin-left: 15px;
            white-space: nowrap;
            flex-shrink: 0;
        }

        /* --- BOTÕES E MODAL --- */
        .card-footer {
            margin-top: 15px;
            text-align: right;
        }
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            color: white;
            background-color: var(--cor-primaria);
        }
        .modal {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0;
            width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: #fefefe; margin: 10% auto; padding: 25px;
            border: 1px solid #888; width: 80%; max-width: 600px; border-radius: 8px;
        }
        .close-btn { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .timeline { list-style-type: none; padding-left: 20px; border-left: 2px solid var(--cor-primaria); }
        .timeline li { margin-bottom: 15px; position: relative; }
        .timeline li::before { content: '●'; color: var(--cor-primaria); position: absolute; left: -28px; top: 0px; font-size: 18px; }
        .timeline .date { font-weight: bold; display: block; color: #555; }
    </style>
</head>
<body>

    <h1>Central de Contratos de Terceiros</h1>

    <main class="kanban-board" id="kanban-board">
        </main>

    <div id="history-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <h2 id="modal-title">Histórico do Processo</h2>
            <ul id="modal-timeline" class="timeline">
                </ul>
        </div>
    </div>


    <script>
    // --- BANCO DE DADOS FALSO (MOCK) PARA O PROTÓTIPO ---
    const mockProcessos = [
        {
            id: 101,
            empresa: "ACME Soluções de TI",
            processo: "Homologação",
            tipoContrato: "Consultoria",
            status: "Pendente Análise",
            ultimaAtualizacao: "2025-10-14",
            zendeskTicket: 87345, // NOVO CAMPO
            checklists: {
                "Homologação": [
                    { tarefa: "BATE PAPO SOBRE HOMOLOGAÇÃO COM O FORNECEDOR", concluida: true, dataConclusao: "12/10/2025" },
                    { tarefa: "E-mail com documentação para novo contrato de prestação de serviços", concluida: true, dataConclusao: "13/10/2025" },
                    { tarefa: "Alimentar informações na planilha de Status e Acompanhamento das Homologações - RMO Terceiros", concluida: false, dataConclusao: null },
                    { tarefa: "Validar documento assim que receber", concluida: false, dataConclusao: null },
                    { tarefa: "Em caso de alteração de valor de função já existente enviar comunicado para o solicitante da Homologação validar", concluida: false, dataConclusao: null },
                    { tarefa: "Se tiver função nova, validar com a Unidade que pediu a homologação se o valor está dentro do acordado", concluida: false, dataConclusao: null },
                    { tarefa: "Aguardando aprovação dos valores e ou inclusão de mais função", concluida: false, dataConclusao: null },
                    { tarefa: "Enviar e-mail para CST Contratos com Formulário, aprovação do gerente e documentação da empresa", concluida: false, dataConclusao: null },
                    { tarefa: "Validar no Protheus se contrato foi finalizado (cadastrado) gerar relatório", concluida: false, dataConclusao: null },
                    { tarefa: "Colocar as informações em nossa planilha na aba Fornecedores e na aba VALOR HORA", concluida: false, dataConclusao: null },
                    { tarefa: "Colocar informação do Fornecedor no Fluig para Proposta de exceção", concluida: false, dataConclusao: null },
                    { tarefa: "Enviar e-mail de Boas Vindas", concluida: false, dataConclusao: null },
                    { tarefa: "Solicitar para a área de CST PMO Local, abrir ticket para cadastro de contrato do fornecedor no Horacius", concluida: false, dataConclusao: null },
                    { tarefa: "Bate papo Onboarding", concluida: false, dataConclusao: null },
                    { tarefa: "Coloca informação na planilha de Status e Acompanhamento das Homologações.", concluida: false, dataConclusao: null },
                    { tarefa: "Responder ticket do Zendesk finalizando o processo e avisando a área.", concluida: false, dataConclusao: null },
                    { tarefa: "Confirmar se preencheram formulário para receber o selo", concluida: false, dataConclusao: null },
                    { tarefa: "Disponibilizar o selo partners para fornecedores SELIND", concluida: false, dataConclusao: null }
                ]
            },
            historico: [
                { data: "2025-10-14", evento: "Fornecedor agendou reunião inicial." },
                { data: "2025-10-13", evento: "Convite de homologação enviado." }
            ]
        },
        {
            id: 102,
            empresa: "Nexus Inovações",
            processo: "Reajuste",
            tipoContrato: "Prestação de Serviços",
            status: "Em Andamento",
            ultimaAtualizacao: "2025-10-15",
            zendeskTicket: 22518, // NOVO CAMPO
             checklists: {
                "Reajuste": [
                    { tarefa: "Receber solicitação de reajuste", concluida: true, dataConclusao: "12/10/2025" },
                    { tarefa: "Analisar índice e contrato", concluida: true, dataConclusao: "15/10/2025" },
                    { tarefa: "Coletar aprovação interna", concluida: false, dataConclusao: null },
                    { tarefa: "Gerar aditivo de valor", concluida: false, dataConclusao: null },
                    { tarefa: "Coletar assinaturas", concluida: false, dataConclusao: null }
                ]
            },
            historico: [
                { data: "2025-10-15", evento: "Análise do índice contratual concluída." },
                { data: "2025-10-12", evento: "Fornecedor solicitou reajuste anual." }
            ]
        },
        {
            id: 103,
            empresa: "Quantum Tech",
            processo: "Homologação",
            tipoContrato: "Consultoria",
            status: "Aguardando Terceiros",
            ultimaAtualizacao: "2025-10-10",
            zendeskTicket: 91023, // NOVO CAMPO
            checklists: { "Homologação": [ { tarefa: "Validar documento assim que receber", concluida: false, dataConclusao: null }, { tarefa: "Alimentar informações na planilha...", concluida: true, dataConclusao: "10/10/2025" }] },
            historico: [
                { data: "2025-10-10", evento: "Pendências na documentação enviadas ao fornecedor." },
                { data: "2025-10-09", evento: "Análise de documentos iniciada." }
            ]
        },
        {
            id: 105,
            empresa: "LogiSystem",
            processo: "Desomologação",
            tipoContrato: "Consultoria",
            status: "Concluído",
            ultimaAtualizacao: "2025-09-30",
            zendeskTicket: 48859, // NOVO CAMPO
            checklists: { "Desomologação": [ { tarefa: "Formalizar distrato", concluida: true, dataConclusao: "30/09/2025" } ]},
            historico: [ { data: "2025-09-30", evento: "Processo de desomologação finalizado." }]
        }
    ];

    // --- FUNÇÕES DE RENDERIZAÇÃO DO KANBAN ---
    
    const colunas = {
        "Pendente Análise": { id: "col-pendente", titulo: "Pendente Análise" },
        "Em Andamento": { id: "col-andamento", titulo: "Em Andamento" },
        "Aguardando Terceiros": { id: "col-aguardando", titulo: "Aguardando Terceiros" },
        "Concluído": { id: "col-concluido", titulo: "Concluído" }
    };

    function renderBoard() {
        const board = document.getElementById('kanban-board');
        board.innerHTML = '';

        for (const status in colunas) {
            const colunaInfo = colunas[status];
            const count = mockProcessos.filter(p => p.status === status).length;
            board.innerHTML += `
                <div class="kanban-column" id="${colunaInfo.id}">
                    <h2>${colunaInfo.titulo} <span class="task-count">${count}</span></h2>
                </div>
            `;
        }
        
        mockProcessos.forEach(processo => {
            const colunaId = colunas[processo.status].id;
            const colunaEl = document.getElementById(colunaId);
            if (colunaEl) {
                colunaEl.innerHTML += createCardHtml(processo);
            }
        });
        
        addChecklistListeners();
    }

    function createCardHtml(processo) {
        const processoSlug = processo.processo.toLowerCase().replace('ç', 'c');
        const checklist = processo.checklists[processo.processo] || [];
        
        let checklistHtml = checklist.map((item, index) => {
            const dataConclusao = item.concluida && item.dataConclusao ? item.dataConclusao : '';
            return `
                <li>
                    <div class="task-content">
                        <input type="checkbox" id="task-${processo.id}-${index}" 
                               data-processo-id="${processo.id}" data-task-index="${index}" 
                               ${item.concluida ? 'checked' : ''}>
                        <label for="task-${processo.id}-${index}" class="${item.concluida ? 'completed' : ''}">${item.tarefa}</label>
                    </div>
                    <small class="checklist-date">${dataConclusao}</small>
                </li>
            `;
        }).join('');

        // MODIFICADO: Adicionada a linha do Zendesk
        return `
            <div class="kanban-card" style="border-left-color: var(--cor-${processoSlug === 'reajuste' ? 'aviso' : processoSlug === 'aditivo' ? 'info' : processoSlug === 'desomologacao' ? 'perigo' : 'primaria'});">
                <div class="card-header">
                    <h3>${processo.empresa}</h3>
                    <span class="badge ${processoSlug}">${processo.processo}</span>
                </div>
                <div class="card-body">
                    <p><strong>Contrato:</strong> ${processo.tipoContrato}</p>
                    <p><strong>Zendesk:</strong> <a href="https://suaempresa.zendesk.com/agent/tickets/${processo.zendeskTicket}" target="_blank">Ticket #${processo.zendeskTicket}</a></p>
                    <p><strong>Última Atividade:</strong> ${new Date(processo.ultimaAtualizacao + 'T12:00:00').toLocaleDateString('pt-BR')}</p>
                </div>
                <details class="checklist-container">
                    <summary>Ver Checklist de Afazeres</summary>
                    <ul class="checklist">${checklistHtml}</ul>
                </details>
                <div class="card-footer">
                    <button class="btn" onclick="openHistoryModal(${processo.id})">Ver Histórico</button>
                </div>
            </div>
        `;
    }

    // --- FUNÇÕES DE INTERATIVIDADE (MODAL, CHECKLISTS) ---
    const modal = document.getElementById('history-modal');

    function openHistoryModal(processoId) {
        const processo = mockProcessos.find(p => p.id === processoId);
        if (!processo) return;

        document.getElementById('modal-title').textContent = `Histórico: ${processo.empresa} - ${processo.processo}`;
        const timelineEl = document.getElementById('modal-timeline');
        timelineEl.innerHTML = processo.historico.map(item => `
            <li>
                <span class="date">${new Date(item.data + 'T12:00:00').toLocaleDateString('pt-BR')}</span>
                <p>${item.evento}</p>
            </li>
        `).join('');
        
        modal.style.display = "block";
    }

    function closeModal() {
        modal.style.display = "none";
    }

    function addChecklistListeners() {
        document.querySelectorAll('.checklist input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const label = this.closest('li').querySelector('label');
                const dateEl = this.closest('li').querySelector('.checklist-date');
                const processoId = parseInt(this.dataset.processoId);
                const taskIndex = parseInt(this.dataset.taskIndex);
                
                const processo = mockProcessos.find(p => p.id === processoId);
                if (!processo) return;
                
                const tarefa = processo.checklists[processo.processo][taskIndex];

                if (this.checked) {
                    const hoje = new Date().toLocaleDateString('pt-BR');
                    tarefa.concluida = true;
                    tarefa.dataConclusao = hoje;
                    label.classList.add('completed');
                    dateEl.textContent = hoje;
                } else {
                    tarefa.concluida = false;
                    tarefa.dataConclusao = null;
                    label.classList.remove('completed');
                    dateEl.textContent = '';
                }
            });
        });
    }
    
    window.onclick = function(event) {
        if (event.target == modal) {
            closeModal();
        }
    }

    // --- INICIA O PROTÓTIPO ---
    document.addEventListener('DOMContentLoaded', renderBoard);
    </script>
</body>
</html>
