<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prot√≥tipo - Central de Contratos de Terceiros</title>
    <style>
        :root {
            --cor-primaria: #0072C6; --cor-sucesso: #28a745; --cor-perigo: #dc3545;
            --cor-aviso: #FFC107; --cor-info: #6f42c1; --cor-fundo: #F4F7FC;
            --cor-fundo-coluna: #E9ECEF; --cor-texto: #333; --cor-borda: #DEE2E6;
            --cor-status-nao-iniciado: #6c757d; --cor-status-formulario-enviado: #007bff; /* Corrigido nome da var */
            --cor-status-em-andamento: #ffc107; --cor-status-cancelado: #dc3545;
            --cor-status-concluido: #28a745;
        }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--cor-fundo); margin: 0; padding: 25px; color: var(--cor-texto); }
        h1, h2 { color: var(--cor-primaria); }
        h1 { text-align: center; margin-bottom: 20px; }

        /* --- NOTIFICA√á√ÉO --- */
        .notification-bar { background-color: var(--cor-aviso); color: #333; padding: 12px 20px; text-align: center; font-size: 16px; font-weight: bold; border-radius: 6px; margin-bottom: 20px; display: none; }
        .notification-bar a { color: var(--cor-primaria); text-decoration: underline; cursor: pointer; }

        /* --- NAVEGA√á√ÉO POR ABAS --- */
        .main-tabs { border-bottom: 2px solid var(--cor-borda); margin-bottom: 25px; text-align: center; }
        .tab-btn { background-color: transparent; border: none; padding: 15px 25px; font-size: 18px; cursor: pointer; color: #555; border-bottom: 4px solid transparent; }
        .tab-btn.active { color: var(--cor-primaria); border-bottom-color: var(--cor-primaria); font-weight: bold; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* --- CONTROLES (PESQUISA E FILTROS) --- */
        .controls-container { display: flex; gap: 15px; margin-bottom: 25px; flex-wrap: wrap; }
        .controls-container input, .controls-container select { padding: 10px; border: 1px solid var(--cor-borda); border-radius: 5px; font-size: 16px; }
        .controls-container input[type="search"] { flex-grow: 1; }
        .controls-container label { display: flex; align-items: center; gap: 5px; font-size: 14px;}

        /* --- LAYOUT DO KANBAN --- */
        .kanban-board { display: flex; gap: 20px; overflow-x: auto; padding-bottom: 20px; }
        .kanban-column { flex: 1; min-width: 320px; background-color: var(--cor-fundo-coluna); border-radius: 8px; padding: 15px; }
        .kanban-column h2 { font-size: 18px; margin: 0 0 15px 0; padding-bottom: 10px; border-bottom: 2px solid var(--cor-borda); display: flex; justify-content: space-between; align-items: center; }
        .task-count { background-color: #ced4da; color: #495057; border-radius: 12px; padding: 2px 10px; font-size: 14px; }

        /* --- ESTILO DOS CARDS --- */
        .card-base { background-color: #FFF; padding: 15px; border-radius: 6px; box-shadow: 0 2px 5px rgba(0,0,0,0.08); margin-bottom: 15px; }
        .kanban-card { border-left: 5px solid; }
        .pos-homologacao-card { border: 1px solid var(--cor-borda); }

        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .card-header h3 { font-size: 16px; margin: 0; }
        .card-header h3 a { color: var(--cor-texto); text-decoration: none; }
        .card-header h3 a:hover { color: var(--cor-primaria); text-decoration: underline; }
        .badge { padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: bold; color: white; }
        .badge.homologacao { background-color: var(--cor-primaria); }
        .badge.reajuste { background-color: var(--cor-aviso); color: #333; }
        .badge.aditivo { background-color: var(--cor-info); }
        .badge.desomologacao { background-color: var(--cor-perigo); }

        .card-body p { font-size: 14px; margin: 5px 0; color: #555; }
        .card-body a { color: var(--cor-primaria); text-decoration: none; font-weight: bold; }
        .card-body a:hover { text-decoration: underline; }

        /* --- CHECKLIST EXPANS√çVEL --- */
        .checklist-container { margin-top: 15px; }
        .checklist-container summary { cursor: pointer; font-weight: bold; color: var(--cor-primaria); font-size: 14px; }
        .checklist { list-style: none; padding: 10px 0 0 5px; margin: 0; }
        .checklist li { font-size: 14px; padding: 8px 0; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #f0f0f0; }
        .task-content { display: flex; align-items: center; flex-grow: 1; margin-right: 10px; /* Evita que o texto encoste na data */ }
        .checklist input[type="checkbox"] { margin-right: 10px; flex-shrink: 0; }
        .checklist label { line-height: 1.4; margin-right: 5px; word-break: break-word; /* Quebra palavras longas */ }
        .checklist label.completed { text-decoration: line-through; color: #888; }
        .checklist-date { font-size: 12px; color: #6c757d; font-style: italic; white-space: nowrap; flex-shrink: 0; }
        .card-footer { margin-top: 15px; text-align: right; }
        .btn { padding: 8px 15px; border: none; border-radius: 5px; font-size: 14px; cursor: pointer; color: white; background-color: var(--cor-primaria);}
        .btn-small { padding: 5px 10px; font-size: 12px; }
        .btn-success { background-color: var(--cor-sucesso); }
        .btn-warning { background-color: var(--cor-aviso); color: #333; }
        .btn:disabled { background-color: #BDBDBD; cursor: not-allowed; }

        /* --- VIS√ÉO DE REAJUSTE --- */
        .reajuste-list { list-style: none; padding: 0; }
        .reajuste-item { display: flex; justify-content: space-between; align-items: center; background: #fff; padding: 20px; border-radius: 6px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .reajuste-info h3 { margin: 0 0 5px 0; font-size: 18px; color: var(--cor-texto); }
        .reajuste-info p { margin: 0; font-size: 14px; color: #555; }
        .reajuste-countdown { text-align: right; }
        .reajuste-countdown .days { font-size: 24px; font-weight: bold; color: var(--cor-primaria); }
        .reajuste-countdown .days.urgent { color: var(--cor-perigo); }
        .reajuste-countdown .label { font-size: 14px; color: #555; }

        /* --- VIS√ÉO P√ìS-HOMOLOGA√á√ÉO --- */
        .pos-homologacao-list { list-style: none; padding: 0; max-width: 900px; margin: 0 auto; }
        .pos-homologacao-card h3 { font-size: 18px; margin-bottom: 10px; color: var(--cor-texto); }
        .pos-homologacao-card p { font-size: 14px; margin: 5px 0; color: #555; }
        .process-section { border-top: 1px solid var(--cor-borda); margin-top: 15px; padding-top: 15px; }
        .process-section h4 { font-size: 15px; margin: 0 0 10px 0; color: var(--cor-primaria); display: flex; justify-content: space-between; align-items: center; }
        .process-section .action-area { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
        .process-section input[type="email"], .process-section select { padding: 8px; border: 1px solid var(--cor-borda); border-radius: 4px; font-size: 14px; }
        .process-section select { background-color: white; }
        .mit-note { font-size: 12px; color: #6c757d; margin-top: 5px; }
        .status-select { font-weight: bold; }
        .status-nao-iniciado { color: var(--cor-status-nao-iniciado); }
        .status-formulario-enviado { color: var(--cor-status-enviado); }
        .status-em-andamento { color: var(--cor-status-andamento); }
        .status-cancelado { color: var(--cor-status-cancelado); }
        .status-concluido { color: var(--cor-status-concluido); }

        /* --- MODAIS --- */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); backdrop-filter: blur(5px); }
        .modal-content { background-color: #fefefe; margin: 5% auto; padding: 30px; border: 1px solid #888; width: 90%; max-width: 600px; border-radius: 8px; box-shadow: 0 5px 20px rgba(0,0,0,0.3); }
        .modal-content.large { max-width: 800px; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--cor-borda); padding-bottom: 15px; margin-bottom: 20px; }
        .modal-header h2 { margin: 0; font-size: 20px; }
        .close-btn { color: #aaa; font-size: 32px; font-weight: bold; cursor: pointer; }

        .email-modal-body { display: flex; flex-direction: column; gap: 15px; }
        .email-modal-body label { font-weight: bold; font-size: 14px; }
        .email-modal-body input, .email-modal-body textarea { width: 100%; padding: 10px; border: 1px solid var(--cor-borda); border-radius: 5px; font-size: 14px; box-sizing: border-box; }
        .email-modal-body textarea { min-height: 150px; resize: vertical; }
        .email-modal-footer { margin-top: 20px; text-align: right; }

        .storytelling-form { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .form-group { display: flex; flex-direction: column; }
        .form-group.full-width { grid-column: 1 / -1; }
        .form-group label { margin-bottom: 5px; font-weight: bold; font-size: 14px; color: #333; }
        .form-group input, .form-group select, .form-group textarea { padding: 10px; font-size: 16px; border: 1px solid var(--cor-borda); border-radius: 5px; }
        .form-group textarea { min-height: 100px; resize: vertical; }

    </style>
</head>
<body>

    <h1>Central de Contratos de Terceiros</h1>
    
    <div id="notification-bar" class="notification-bar"></div>

    <nav class="main-tabs">
        <button class="tab-btn active" onclick="openTab(event, 'kanban-view')">Kanban de Processos</button>
        <button class="tab-btn" onclick="openTab(event, 'reajuste-view')">Anivers√°rio (Reajuste)</button>
        <button class="tab-btn" onclick="openTab(event, 'pos-homologacao-view')">P√≥s-Homologa√ß√£o</button>
    </nav>

    <div id="kanban-view" class="tab-content active">
        <div class="controls-container">
            <input type="search" id="search-input" placeholder="Pesquisar por empresa...">
            <select id="filter-status"> <option value="">Filtrar por Status</option> </select>
            <select id="filter-processo"> <option value="">Filtrar por Tipo</option> </select>
        </div>
        <main class="kanban-board" id="kanban-board"></main>
    </div>

    <div id="reajuste-view" class="tab-content">
        <div class="controls-container">
            <input type="search" id="reajuste-search-input" placeholder="Pesquisar por empresa...">
            <select id="reajuste-sort">
                <option value="asc">Classificar por dias (Crescente)</option>
                <option value="desc">Classificar por dias (Decrescente)</option>
            </select>
            <label for="reajuste-period-filter">Filtrar por M√™s/Ano:</label>
            <input type="month" id="reajuste-period-filter">
        </div>
        <ul class="reajuste-list" id="reajuste-list"></ul>
    </div>

    <div id="pos-homologacao-view" class="tab-content">
        <div class="controls-container">
            <input type="search" id="pos-homologacao-search" placeholder="Pesquisar por empresa homologada...">
        </div>
        <ul class="pos-homologacao-list" id="pos-homologacao-list"></ul>
    </div>

    <div id="history-modal" class="modal"> <div class="modal-content large"> <div class="modal-header"> <h2 id="modal-title">Hist√≥rico</h2> <span class="close-btn" onclick="closeModal('history-modal')">&times;</span> </div> <ul id="modal-timeline" class="timeline"></ul> </div> </div>
    <div id="storytelling-modal" class="modal"> <div class="modal-content large"> <div class="modal-header"> <h2 id="storytelling-title">Detalhes</h2> <span class="close-btn" onclick="closeModal('storytelling-modal')">&times;</span> </div> <form class="storytelling-form"> <div class="form-group"><label for="st-fornecedor">FORNECEDOR</label><input type="text" id="st-fornecedor" readonly></div> <div class="form-group"><label for="st-codigo">C√ìDIGO (6 d√≠gitos)</label><input type="number" id="st-codigo"></div> <div class="form-group"><label for="st-cnpj">CNPJ</label><input type="text" id="st-cnpj"></div> <div class="form-group"><label for="st-contato-excecao">NOME CONTATO P. EXCE√á√ÉO</label><input type="text" id="st-contato-excecao"></div> <div class="form-group"><label for="st-email-excecao">E-MAIL ASSINATURA P. EXCE√á√ÉO</label><input type="email" id="st-email-excecao"></div> <div class="form-group"><label for="st-telefone">TELEFONE (11 d√≠gitos)</label><input type="tel" id="st-telefone"></div> <div class="form-group"><label for="st-contatos-demanda">CONTATOS P/ DEMANDA</label><input type="text" id="st-contatos-demanda"></div> <div class="form-group"><label for="st-telefone-demanda">TELEFONE DEMANDA (11 d√≠gitos)</label><input type="tel" id="st-telefone-demanda"></div> <div class="form-group"><label for="st-receber-demanda">RECEBER DEMANDA?</label><select id="st-receber-demanda"><option>Sim</option><option>N√£o</option></select></div> <div class="form-group"><label for="st-tipo-contrato">TIPO DE CONTRATO</label><input type="text" id="st-tipo-contrato"></div> <div class="form-group"><label for="st-estado">ESTADO (UF)</label><select id="st-estado"></select></div> <div class="form-group"><label for="st-numero-contrato">NUMERO CONTRATO</label><input type="text" id="st-numero-contrato"></div> <div class="form-group full-width"><label for="st-contatos-fechamento">CONTATOS P/ FECHAMENTO</label><input type="text" id="st-contatos-fechamento"></div> <div class="form-group"><label for="st-canal">√â CANAL?</label><select id="st-canal"><option>Sim</option><option>N√£o</option></select></div> <div class="form-group"><label for="st-selo">ELEG√çVEL AO SELO?</label><select id="st-selo"><option>Sim</option><option>N√£o</option></select></div> <div class="form-group"><label for="st-responsavel-selo">Respons√°vel pelo Selo</label><input type="text" id="st-responsavel-selo"></div> <div class="form-group"><label for="st-email-selo">E-mail respons√°vel pelo selo</label><input type="email" id="st-email-selo"></div> <div class="form-group"><label for="st-filiais-cxs">CONTRATO FILIAIS TTS CXS/POA?</label><select id="st-filiais-cxs"><option>Sim</option><option>N√£o</option></select></div> <div class="form-group"><label for="st-filiais-ip">CONTRATO FILIAIS TTS IP?</label><select id="st-filiais-ip"><option>Sim</option><option>N√£o</option></select></div> <div class="form-group full-width"><label for="st-area-solicitante">√ÅREA SOLICITANTE</label><input type="text" id="st-area-solicitante"></div> <div class="form-group full-width"><label for="st-obs">OBSERVA√á√ÉO</label><textarea id="st-obs"></textarea></div> </form> </div> </div>
    <div id="painelFornecedorModal" class="modal"> <div class="modal-content"> <div class="modal-header"> <h2 id="painelFornecedorModalTitle">Enviar Convite - Painel Fornecedor</h2> <span class="close-btn" onclick="closeModal('painelFornecedorModal')">&times;</span> </div> <div class="email-modal-body"> <p>O e-mail abaixo ser√° enviado ao fornecedor...</p> <div><label for="painel-email-to">Enviar para:</label><input type="email" id="painel-email-to" placeholder="Insira o e-mail"></div> <div><label>Assunto:</label><input type="text" value="Acesso ao Painel do Fornecedor - Pr√≥ximos Passos" readonly></div> <div><label>Mensagem:</label><textarea id="painel-email-body" readonly>Prezados(as) da [Nome da Empresa],...</textarea></div> </div> <div class="email-modal-footer"> <button class="btn btn-success" onclick="simularEnvioEmail('painelFornecedorModal')">Enviar E-mail</button> </div> </div> </div>
    <div id="mitUniversidadeModal" class="modal"> <div class="modal-content"> <div class="modal-header"> <h2>Notificar Universidade - MIT</h2> <span class="close-btn" onclick="closeModal('mitUniversidadeModal')">&times;</span> </div> <div class="email-modal-body"> <p>O e-mail abaixo ser√° enviado √† Universidade Corporativa...</p> <div><label for="mitUni-email-to">Para:</label><input type="email" id="mitUni-email-to" value="universidade.corporativa@example.com"></div> <div><label for="mitUni-email-cc">CC:</label><input type="email" id="mitUni-email-cc" placeholder="Opcional"></div> <div><label>Assunto:</label><input type="text" id="mitUni-email-subject" readonly></div> <div><label>Mensagem:</label><textarea id="mitUni-email-body" readonly>Prezados da Universidade Corporativa,...</textarea></div> </div> <div class="email-modal-footer"> <button class="btn btn-success" onclick="simularEnvioEmail('mitUniversidadeModal')">Enviar E-mail</button> </div> </div> </div>
    <div id="mitFornecedorModal" class="modal"> <div class="modal-content"> <div class="modal-header"> <h2>Notificar Fornecedor - MIT</h2> <span class="close-btn" onclick="closeModal('mitFornecedorModal')">&times;</span> </div> <div class="email-modal-body"> <p>O e-mail abaixo ser√° enviado ao fornecedor...</p> <div><label for="mitForn-email-to">Para:</label><input type="email" id="mitForn-email-to" placeholder="E-mail do contato"></div> <div><label for="mitForn-email-cc">CC:</label><input type="email" id="mitForn-email-cc" placeholder="Opcional"></div> <div><label>Assunto:</label><input type="text" value="Capacita√ß√£o Obrigat√≥ria MIT Liberada" readonly></div> <div><label>Mensagem:</label><textarea id="mitForn-email-body" readonly>Prezados(as) da [Nome da Empresa],...</textarea></div> </div> <div class="email-modal-footer"> <button class="btn btn-success" onclick="simularEnvioEmail('mitFornecedorModal')">Enviar E-mail</button> </div> </div> </div>

    <script>
    // --- BANCO DE DADOS FALSO (MOCK) - CORRIGIDO E COMPLETO ---
    let mockProcessos = [
        {
            id: 101, empresa: "ACME Solu√ß√µes de TI", processo: "Homologa√ß√£o", tipoContrato: "Consultoria", status: "Conclu√≠do", ultimaAtualizacao: "2025-10-14", zendeskTicket: 87345,
            dataHomologacao: "2024-10-20", dataConclusaoHomologacao: "2025-10-14",
            storytelling: { codigo: 100201, cnpj: "12.345.678/0001-99", estado: "SP", numeroContrato: "CTR-2024-1020", ehCanal: "N√£o", elegivelSelo: "Sim", emailSelo: "mariana.lima@acme.com", emailExcecao: "ana.silva@acme.com" },
            checklists: { "Homologa√ß√£o": [
                { tarefa: "BATE PAPO SOBRE HOMOLOGA√á√ÉO COM O FORNECEDOR", concluida: true, dataConclusao: "12/10/2025" }, { tarefa: "E-mail com documenta√ß√£o para novo contrato de presta√ß√£o de servi√ßos", concluida: true, dataConclusao: "13/10/2025" },
                { tarefa: "Alimentar informa√ß√µes na planilha de Status e Acompanhamento das Homologa√ß√µes - RMO Terceiros", concluida: true, dataConclusao: "13/10/2025" }, { tarefa: "Validar documento assim que receber", concluida: true, dataConclusao: "14/10/2025" },
                { tarefa: "Em caso de altera√ß√£o de valor de fun√ß√£o j√° existente enviar comunicado para o solicitante da Homologa√ß√£o validar", concluida: true, dataConclusao: "14/10/2025" }, { tarefa: "Se tiver fun√ß√£o nova, validar com a Unidade que pediu a homologa√ß√£o se o valor est√° dentro do acordado", concluida: true, dataConclusao: "14/10/2025" },
                { tarefa: "Aguardando aprova√ß√£o dos valores e ou inclus√£o de mais fun√ß√£o", concluida: true, dataConclusao: "14/10/2025" }, { tarefa: "Enviar e-mail para CST Contratos com Formul√°rio, aprova√ß√£o do gerente e documenta√ß√£o da empresa", concluida: true, dataConclusao: "14/10/2025" },
                { tarefa: "Validar no Protheus se contrato foi finalizado (cadastrado) gerar relat√≥rio", concluida: true, dataConclusao: "14/10/2025" }, { tarefa: "Colocar as informa√ß√µes em nossa planilha na aba Fornecedores e na aba VALOR HORA", concluida: true, dataConclusao: "14/10/2025" },
                { tarefa: "Colocar informa√ß√£o do Fornecedor no Fluig para Proposta de exce√ß√£o", concluida: true, dataConclusao: "14/10/2025" }, { tarefa: "Enviar e-mail de Boas Vindas", concluida: true, dataConclusao: "14/10/2025" },
                { tarefa: "Solicitar para a √°rea de CST PMO Local, abrir ticket para cadastro de contrato do fornecedor no Horacius", concluida: true, dataConclusao: "14/10/2025" }, { tarefa: "Bate papo Onboarding", concluida: true, dataConclusao: "14/10/2025" },
                { tarefa: "Coloca informa√ß√£o na planilha de Status e Acompanhamento das Homologa√ß√µes.", concluida: true, dataConclusao: "14/10/2025" }, { tarefa: "Responder ticket do Zendesk finalizando o processo e avisando a √°rea.", concluida: true, dataConclusao: "14/10/2025" },
                { tarefa: "Confirmar se preencheram formul√°rio para receber o selo", concluida: true, dataConclusao: "14/10/2025" }, { tarefa: "Disponibilizar o selo partners para fornecedores SELIND", concluida: true, dataConclusao: "14/10/2025" }
            ]},
            historico: [ { data: "2025-10-14", evento: "Processo de Homologa√ß√£o Conclu√≠do." } ],
            posHomologacaoStatus: { painelFornecedor: "N√£o iniciado", seloPartners: "N√£o iniciado", liberacaoMit: "N√£o iniciado" }
        },
        {
            id: 102, empresa: "Nexus Inova√ß√µes", processo: "Reajuste", tipoContrato: "Presta√ß√£o de Servi√ßos", status: "Em Andamento", ultimaAtualizacao: "2025-10-15", zendeskTicket: 22518,
            dataHomologacao: "2024-12-05", storytelling: { codigo: 100315, ehCanal: "Sim", elegivelSelo: "Sim" },
            checklists: { "Reajuste": [ { tarefa: "Receber solicita√ß√£o de reajuste", concluida: true, dataConclusao: "12/10/2025" }, { tarefa: "Analisar √≠ndice e contrato", concluida: true, dataConclusao: "15/10/2025"}, { tarefa: "Coletar aprova√ß√£o interna", concluida: false, dataConclusao: null} ] }, // Checklist mais completo
            historico: [ { data: "2025-10-15", evento: "An√°lise do √≠ndice contratual conclu√≠da." } ]
        },
        {
            id: 103, empresa: "Quantum Tech", processo: "Homologa√ß√£o", tipoContrato: "Consultoria", status: "Aguardando Terceiros", ultimaAtualizacao: "2025-10-10", zendeskTicket: 91023,
            dataHomologacao: "2025-08-01", storytelling: { codigo: 100450, ehCanal: "N√£o", elegivelSelo: "N√£o" },
             checklists: { "Homologa√ß√£o": [ // Checklist completo, status diferente
                { tarefa: "BATE PAPO SOBRE HOMOLOGA√á√ÉO COM O FORNECEDOR", concluida: true, dataConclusao: "05/08/2025" }, { tarefa: "E-mail com documenta√ß√£o para novo contrato de presta√ß√£o de servi√ßos", concluida: true, dataConclusao: "06/08/2025" },
                { tarefa: "Alimentar informa√ß√µes na planilha de Status e Acompanhamento das Homologa√ß√µes - RMO Terceiros", concluida: true, dataConclusao: "06/08/2025" }, { tarefa: "Validar documento assim que receber", concluida: false, dataConclusao: null },
                { tarefa: "Em caso de altera√ß√£o de valor de fun√ß√£o j√° existente enviar comunicado para o solicitante da Homologa√ß√£o validar", concluida: false, dataConclusao: null }, { tarefa: "Se tiver fun√ß√£o nova, validar com a Unidade que pediu a homologa√ß√£o se o valor est√° dentro do acordado", concluida: false, dataConclusao: null },
                { tarefa: "Aguardando aprova√ß√£o dos valores e ou inclus√£o de mais fun√ß√£o", concluida: false, dataConclusao: null }, { tarefa: "Enviar e-mail para CST Contratos com Formul√°rio, aprova√ß√£o do gerente e documenta√ß√£o da empresa", concluida: false, dataConclusao: null },
                { tarefa: "Validar no Protheus se contrato foi finalizado (cadastrado) gerar relat√≥rio", concluida: false, dataConclusao: null }, { tarefa: "Colocar as informa√ß√µes em nossa planilha na aba Fornecedores e na aba VALOR HORA", concluida: false, dataConclusao: null },
                { tarefa: "Colocar informa√ß√£o do Fornecedor no Fluig para Proposta de exce√ß√£o", concluida: false, dataConclusao: null }, { tarefa: "Enviar e-mail de Boas Vindas", concluida: false, dataConclusao: null },
                { tarefa: "Solicitar para a √°rea de CST PMO Local, abrir ticket para cadastro de contrato do fornecedor no Horacius", concluida: false, dataConclusao: null }, { tarefa: "Bate papo Onboarding", concluida: false, dataConclusao: null },
                { tarefa: "Coloca informa√ß√£o na planilha de Status e Acompanhamento das Homologa√ß√µes.", concluida: false, dataConclusao: null }, { tarefa: "Responder ticket do Zendesk finalizando o processo e avisando a √°rea.", concluida: false, dataConclusao: null },
                { tarefa: "Confirmar se preencheram formul√°rio para receber o selo", concluida: false, dataConclusao: null }, { tarefa: "Disponibilizar o selo partners para fornecedores SELIND", concluida: false, dataConclusao: null }
            ]},
            historico: [ { data: "2025-10-10", evento: "Pend√™ncias na documenta√ß√£o enviadas ao fornecedor." } ]
        },
        {
            id: 104, empresa: "Orion Solu√ß√µes", processo: "Aditivo", tipoContrato: "Consultoria", status: "Pendente An√°lise", ultimaAtualizacao: "2025-10-12", zendeskTicket: 34567,
            dataHomologacao: "2023-01-15", storytelling: { codigo: 100500, ehCanal: "N√£o", elegivelSelo: "Sim" },
            checklists: { "Aditivo": [ { tarefa: "Receber solicita√ß√£o", concluida: true, dataConclusao: "12/10/2025"}, { tarefa: "Analisar escopo e cl√°usulas", concluida: false, dataConclusao: null } ] }, // Checklist exemplo
            historico: [ { data: "2025-10-12", evento: "Recebida solicita√ß√£o de aditivo para incluir novo servi√ßo." } ]
        },
        {
            id: 105, empresa: "LogiSystem", processo: "Desomologa√ß√£o", tipoContrato: "Consultoria", status: "Conclu√≠do", ultimaAtualizacao: "2025-09-30", zendeskTicket: 48859,
            dataHomologacao: "2022-05-20", storytelling: { codigo: 100112, ehCanal: "N√£o", elegivelSelo: "Sim" },
            checklists: { "Desomologa√ß√£o": [ { tarefa: "Receber solicita√ß√£o", concluida: true, dataConclusao: "15/09/2025"}, { tarefa: "Formalizar distrato", concluida: true, dataConclusao: "30/09/2025" } ]}, // Checklist exemplo
            historico: [ { data: "2025-09-30", evento: "Processo de desomologa√ß√£o finalizado." }]
        }
    ];

    // --- L√ìGICA GERAL DA P√ÅGINA ---
    document.addEventListener('DOMContentLoaded', () => {
        populateFilters();
        populateUfSelect();
        renderKanbanView(); // Renderiza a aba inicial ativa (Kanban)
        
        // Listeners Kanban
        document.getElementById('search-input').addEventListener('input', renderKanbanView);
        document.getElementById('filter-status').addEventListener('change', renderKanbanView);
        document.getElementById('filter-processo').addEventListener('change', renderKanbanView);
        
        // Listeners Reajuste
        document.getElementById('reajuste-search-input').addEventListener('input', renderReajusteView);
        document.getElementById('reajuste-sort').addEventListener('change', renderReajusteView);
        document.getElementById('reajuste-period-filter').addEventListener('change', renderReajusteView);

        // Listener P√≥s-Homologa√ß√£o
        document.getElementById('pos-homologacao-search').addEventListener('input', renderPosHomologacaoView);
    });

    // --- L√ìGICA DAS ABAS ---
    function openTab(evt, tabName) {
        document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById(tabName).classList.add('active');
        evt.currentTarget.classList.add('active');

        if (tabName === 'kanban-view') renderKanbanView();
        else if (tabName === 'reajuste-view') renderReajusteView();
        else if (tabName === 'pos-homologacao-view') renderPosHomologacaoView();
    }
    
    // --- L√ìGICA DA NOTIFICA√á√ÉO ---
    function updateNotification() {
        const notificationBar = document.getElementById('notification-bar');
        const pendingCount = mockProcessos.filter(p => p.status === 'Pendente An√°lise').length;
        if (pendingCount > 0) {
            notificationBar.innerHTML = `üîî Voc√™ tem ${pendingCount} ${pendingCount > 1 ? 'pend√™ncias' : 'pend√™ncia'} na coluna <a onclick="focusPending()">"Pendente An√°lise"</a>.`;
            notificationBar.style.display = 'block';
        } else {
            notificationBar.style.display = 'none';
        }
    }
    function focusPending() { /* ... c√≥digo id√™ntico ... */ }

    // --- L√ìGICA DO KANBAN ---
    const colunas = { "Pendente An√°lise": { id: "col-pendente", titulo: "Pendente An√°lise" }, "Em Andamento": { id: "col-andamento", titulo: "Em Andamento" }, "Aguardando Terceiros": { id: "col-aguardando", titulo: "Aguardando Terceiros" }, "Conclu√≠do": { id: "col-concluido", titulo: "Conclu√≠do" } };
    function populateFilters() { /* ... c√≥digo id√™ntico ... */ }
    function renderKanbanView() { // CORRIGIDO: Garante que os cards sejam renderizados
        updateNotification();
        const board = document.getElementById('kanban-board'); board.innerHTML = '';
        const searchTerm = document.getElementById('search-input').value.toLowerCase();
        const statusFilter = document.getElementById('filter-status').value;
        const processoFilter = document.getElementById('filter-processo').value;
        const filteredProcessos = mockProcessos.filter(p => p.empresa.toLowerCase().includes(searchTerm) && (!statusFilter || p.status === statusFilter) && (!processoFilter || p.processo === processoFilter));
        
        // Cria as colunas primeiro
        for (const status in colunas) { const colInfo = colunas[status]; const count = filteredProcessos.filter(p => p.status === status).length; board.innerHTML += `<div class="kanban-column" id="${colInfo.id}"><h2 >${colInfo.titulo} <span class="task-count">${count}</span></h2></div>`; }
        
        // Depois adiciona os cards √†s colunas corretas
        filteredProcessos.forEach(p => { 
            const colEl = document.getElementById(colunas[p.status]?.id); // Adiciona verifica√ß√£o ?.id
            if (colEl) { // Verifica se a coluna existe antes de adicionar
                 colEl.innerHTML += createCardHtml(p); 
            } else {
                console.warn(`Coluna n√£o encontrada para status: ${p.status}`);
            }
        });
        addChecklistListeners(); 
    }
    function createCardHtml(processo) { // CORRIGIDO: Refer√™ncia correta ao 'processo'
        const processoSlug = processo.processo.toLowerCase().replace(/√ß/g, 'c').replace(/√£/g, 'a');
        const checklist = processo.checklists[processo.processo] || [];
        let checklistHtml = checklist.map((item, index) => {
            const dataConclusao = item.concluida && item.dataConclusao ? item.dataConclusao : '';
            return `<li><div class="task-content"><input type="checkbox" id="task-${processo.id}-${index}" data-processo-id="${processo.id}" data-task-index="${index}" ${item.concluida ? 'checked' : ''}><label for="task-${processo.id}-${index}" class="${item.concluida ? 'completed' : ''}">${item.tarefa}</label></div><small class="checklist-date">${dataConclusao}</small></li>`;
        }).join('');
        return `<div class="kanban-card card-base" style="border-left-color: var(--cor-${processoSlug === 'reajuste' ? 'aviso' : processoSlug === 'aditivo' ? 'info' : processoSlug === 'desomologacao' ? 'perigo' : 'primaria'});"><div class="card-header"><h3><a href="#" onclick="event.preventDefault(); openStorytellingModal(${processo.id})">${processo.empresa}</a></h3><span class="badge ${processoSlug}">${processo.processo}</span></div><div class="card-body"><p><strong>Zendesk:</strong> <a href="#" target="_blank">Ticket #${processo.zendeskTicket}</a></p><p><strong>√öltima Atividade:</strong> ${new Date(processo.ultimaAtualizacao + 'T12:00:00Z').toLocaleDateString('pt-BR')}</p></div><details class="checklist-container"><summary>Ver Checklist de Afazeres</summary><ul class="checklist">${checklistHtml}</ul></details><div class="card-footer"><button class="btn" onclick="openHistoryModal(${processo.id})">Ver Hist√≥rico</button></div></div>`;
    }

    // --- L√ìGICA DA ABA DE REAJUSTE ---
    function renderReajusteView() { // CORRIGIDO: Garante que a lista seja renderizada
        const listEl = document.getElementById('reajuste-list'); listEl.innerHTML = '';
        const hoje = new Date();
        const searchTerm = document.getElementById('reajuste-search-input').value.toLowerCase();
        const sortOrder = document.getElementById('reajuste-sort').value;
        const periodFilter = document.getElementById('reajuste-period-filter').value;
        let fornecedores = mockProcessos.filter(p => p.dataHomologacao).map(p => { const d = new Date(p.dataHomologacao + 'T12:00:00Z'); let n = new Date(d); n.setFullYear(hoje.getFullYear()); if (n < hoje) { n.setFullYear(hoje.getFullYear() + 1); } const diff = Math.ceil((n - hoje) / (1000 * 60 * 60 * 24)); return { ...p, proximoAniversario: n, diffDays: diff }; }).filter(p => { const search = p.empresa.toLowerCase().includes(searchTerm); let period = true; if (periodFilter) { const [y, m] = periodFilter.split('-'); period = p.proximoAniversario.getFullYear() == y && (p.proximoAniversario.getMonth() + 1) == m; } return search && period; });
        fornecedores.sort((a, b) => sortOrder === 'asc' ? a.diffDays - b.diffDays : b.diffDays - a.diffDays);
        if (fornecedores.length === 0) { listEl.innerHTML = '<p style="text-align:center; color: #555;">Nenhum fornecedor encontrado para os filtros aplicados.</p>'; return; }
        fornecedores.forEach(p => { const urgentClass = p.diffDays <= 30 ? 'urgent' : ''; listEl.innerHTML += `<li class="reajuste-item"><div class="reajuste-info"><h3>${p.empresa}</h3><p>Data de Homologa√ß√£o: ${new Date(p.dataHomologacao + 'T12:00:00Z').toLocaleDateString('pt-BR')} | Pr√≥ximo Anivers√°rio: ${p.proximoAniversario.toLocaleDateString('pt-BR')}</p></div><div class="reajuste-countdown"><div class="days ${urgentClass}">${p.diffDays}</div><div class="label">dias restantes</div></div></li>`; });
    }

    // --- L√ìGICA DA ABA P√ìS-HOMOLOGA√á√ÉO ---
     function createStatusSelect(id, name, current, options) {
        let opts = options.map(o => `<option value="${o}" ${o === current ? 'selected' : ''}>${o}</option>`).join('');
        // Corrigido: Substitui espa√ßo por h√≠fen para nome de classe CSS v√°lido
        const cls = `status-${current.toLowerCase().replace(/ /g, '-')}`; 
        return `<select class="status-select ${cls}" onchange="updatePosHomologacaoStatus(${id}, '${name}', this.value)">${opts}</select>`;
    }
    function updatePosHomologacaoStatus(id, name, status) {
        const p = mockProcessos.find(p => p.id === id);
        if (p && p.posHomologacaoStatus) {
            p.posHomologacaoStatus[name] = status;
            renderPosHomologacaoView(); 
        }
    }
     function createPosHomologacaoCardHtml(processo) { // CORRIGIDO: Bot√µes MIT chamam as fun√ß√µes corretas
        const isCanal = processo.storytelling?.ehCanal === "Sim";
        const dataConclusao = processo.dataConclusaoHomologacao ? new Date(processo.dataConclusaoHomologacao + 'T12:00:00Z') : null;
        const hoje = new Date();
        const diffDays = dataConclusao ? Math.floor((hoje - dataConclusao) / (1000 * 60 * 60 * 24)) : null;
        const mitEligible = diffDays !== null && diffDays >= 30; 
        if (!processo.posHomologacaoStatus) { processo.posHomologacaoStatus = { painelFornecedor: "N√£o iniciado", seloPartners: "N√£o iniciado", liberacaoMit: "N√£o iniciado" }; }
        const { painelFornecedor, seloPartners, liberacaoMit } = processo.posHomologacaoStatus;
        const s1 = createStatusSelect(processo.id, 'painelFornecedor', painelFornecedor, ["N√£o iniciado", "Formul√°rio enviado", "Em andamento", "Cancelado", "Conclu√≠do"]);
        const s2 = createStatusSelect(processo.id, 'seloPartners', seloPartners, ["N√£o iniciado", "Em andamento", "Cancelado", "Conclu√≠do"]);
        const s3 = createStatusSelect(processo.id, 'liberacaoMit', liberacaoMit, ["N√£o iniciado", "Em andamento", "Cancelado", "Conclu√≠do"]);
        return `<li class="pos-homologacao-card card-base" id="pos-card-${processo.id}"><h3>${processo.empresa}</h3><p><strong>Homologado em:</strong> ${dataConclusao ? dataConclusao.toLocaleDateString('pt-BR') : 'N/D'}</p><div class="process-section"><h4>Painel Fornecedor ${s1}</h4><div class="action-area"><button class="btn btn-small" onclick="openPainelFornecedorModal(${processo.id})" ${painelFornecedor !== 'N√£o iniciado' ? 'disabled' : ''}>Enviar Formul√°rio</button></div></div><div class="process-section"><h4>Selo Partners ${s2}</h4>${isCanal ? '<p style="color:var(--cor-sucesso); font-weight:bold;">‚úÖ Fornecedor √© Canal.</p>' : '<p style="color:var(--cor-perigo);">‚ùå Fornecedor N√ÉO √© Canal.</p>'}<div class="action-area"><input type="email" value="${processo.storytelling?.emailSelo || ''}" placeholder="E-mail do Respons√°vel pelo Selo" style="flex-grow: 1;" ${!isCanal ? 'disabled' : ''}></div></div><div class="process-section"><h4>Libera√ß√£o MIT ${s3}</h4><p class="mit-note">${diffDays !== null ? `Dias desde a conclus√£o: ${diffDays}.` : ''} ${mitEligible ? '<strong style="color:var(--cor-sucesso);">Eleg√≠vel para MIT.</strong>' : '<strong style="color:var(--cor-aviso);">Aguardando 30 dias.</strong>'}</p><div class="action-area"><button class="btn btn-small btn-warning" onclick="openMitUniversidadeModal(${processo.id})" ${!mitEligible ? 'disabled' : ''}>Notificar Universidade</button><button class="btn btn-small btn-success" onclick="openMitFornecedorModal(${processo.id})" ${!mitEligible ? 'disabled' : ''}>Notificar Fornecedor</button></div></div></li>`;
    }
    function renderPosHomologacaoView() { // CORRIGIDO: Garante que a lista seja renderizada
        const listEl = document.getElementById('pos-homologacao-list'); listEl.innerHTML = '';
        const searchTerm = document.getElementById('pos-homologacao-search').value.toLowerCase();
        const concluidos = mockProcessos.filter(p => p.processo === "Homologa√ß√£o" && p.status === "Conclu√≠do" && p.empresa.toLowerCase().includes(searchTerm));
        if (concluidos.length === 0) { listEl.innerHTML = '<p style="text-align:center; color: #555;">Nenhum processo de homologa√ß√£o conclu√≠do encontrado.</p>'; return; }
        concluidos.forEach(p => { listEl.innerHTML += createPosHomologacaoCardHtml(p); });
    }

    // --- L√ìGICA DOS MODAIS E INTERATIVIDADE ---
    let currentProcessId = null;
    function openPainelFornecedorModal(id) { currentProcessId = id; const p = mockProcessos.find(p => p.id === id); if(!p) return; document.getElementById('painelFornecedorModalTitle').textContent = `Enviar Convite - Painel Fornecedor (${p.empresa})`; document.getElementById('painel-email-to').value = p.storytelling?.emailExcecao || ''; document.getElementById('painel-email-body').value = `Prezados(as) da ${p.empresa},\n\nParab√©ns pela conclus√£o da homologa√ß√£o!\n\nConforme conversamos em nosso onboarding, o pr√≥ximo passo √© o preenchimento das informa√ß√µes no Painel do Fornecedor. Isso garantir√° que sua equipe tenha os acessos necess√°rios √†s nossas plataformas.\n\nPor favor, clique no link abaixo para acessar e completar o formul√°rio:\n[Link Simulado para o Formul√°rio do Painel]\n\nAgradecemos a colabora√ß√£o.\nAtenciosamente,`; openModal('painelFornecedorModal'); }
    function openMitUniversidadeModal(id) { currentProcessId = id; const p = mockProcessos.find(p => p.id === id); if(!p) return; document.getElementById('mitUni-email-subject').value = `Libera√ß√£o de Acesso - Treinamento MIT - Fornecedor ${p.empresa}`; document.getElementById('mitUni-email-body').value = `Prezados da Universidade Corporativa,\n\nGostar√≠amos de informar que o fornecedor ${p.empresa} concluiu o processo de homologa√ß√£o e est√° apto a iniciar a trilha de capacita√ß√£o obrigat√≥ria MIT (Meu Ingresso na TOTVS).\n\nSolicitamos, por gentileza, a libera√ß√£o do acesso para os recursos que ser√£o cadastrados por eles.\n\nObrigado(a).`; openModal('mitUniversidadeModal'); }
    function openMitFornecedorModal(id) { currentProcessId = id; const p = mockProcessos.find(p => p.id === id); if(!p) return; document.getElementById('mitForn-email-to').value = p.storytelling?.emailExcecao || ''; document.getElementById('mitForn-email-body').value = `Prezados(as) da ${p.empresa},\n\nInformamos que a trilha de capacita√ß√£o obrigat√≥ria MIT (Meu Ingresso na TOTVS) j√° est√° liberada para os seus recursos.\n\n√â fundamental que todos os profissionais alocados concluam este treinamento antes de iniciarem suas atividades. Instruam sua equipe a acessar a plataforma da Universidade Corporativa com os dados que receber√£o.\n\nQualquer d√∫vida, estamos √† disposi√ß√£o.\nAtenciosamente,`; openModal('mitFornecedorModal'); }
    function simularEnvioEmail(modalId) { alert("Simulando envio de e-mail..."); closeModal(modalId); if (modalId === 'painelFornecedorModal' && currentProcessId) { updatePosHomologacaoStatus(currentProcessId, 'painelFornecedor', 'Formul√°rio enviado'); } }
    function openHistoryModal(id) { const p = mockProcessos.find(p => p.id === id); if (p) { document.getElementById('modal-title').textContent = `Hist√≥rico: ${p.empresa}`; document.getElementById('modal-timeline').innerHTML = (p.historico || []).map(i => `<li><span class="date">${new Date(i.data + 'T12:00:00Z').toLocaleDateString('pt-BR')}</span><p>${i.evento}</p></li>`).join(''); openModal('history-modal'); } }
    function openStorytellingModal(id) { const p = mockProcessos.find(p => p.id === id); if (!p || !p.storytelling) { console.error("Dados storytelling n√£o encontrados para:", id); return; } const s = p.storytelling; document.getElementById('storytelling-title').textContent = `Detalhes de ${p.empresa}`; Object.keys(s).forEach(k => { const fieldId = `st-${k.replace(/([A-Z])/g, "-$1").toLowerCase()}`; const el = document.getElementById(fieldId); if(el) el.value = s[k] ?? ''; else console.warn("Elemento n√£o encontrado para storytelling:", fieldId); }); document.getElementById('st-fornecedor').value = p.empresa; document.getElementById('st-tipo-contrato').value = p.tipoContrato; openModal('storytelling-modal'); }
    function closeModal(modalId) { document.getElementById(modalId).style.display = 'none'; }
    function openModal(modalId) { document.getElementById(modalId).style.display = 'block'; }
    function addChecklistListeners() { document.querySelectorAll('.checklist input[type="checkbox"]').forEach(c => { c.removeEventListener('change', handleChecklistChange); c.addEventListener('change', handleChecklistChange); }); }
    function handleChecklistChange() { const label = this.closest('li').querySelector('label'); const dateEl = this.closest('li').querySelector('.checklist-date'); const pId = parseInt(this.dataset.processoId), tIdx = parseInt(this.dataset.taskIndex); const p = mockProcessos.find(p => p.id === pId); if (!p) return; const t = p.checklists[p.processo]?.[tIdx]; if (!t) return; if (this.checked) { const hoje = new Date().toLocaleDateString('pt-BR'); t.concluida = true; t.dataConclusao = hoje; label.classList.add('completed'); dateEl.textContent = hoje; } else { t.concluida = false; t.dataConclusao = null; label.classList.remove('completed'); dateEl.textContent = ''; } }
    function populateUfSelect() { const ufs = ["AC", "AL", "AP", "AM", "BA", "CE", "DF", "ES", "GO", "MA", "MT", "MS", "MG", "PA", "PB", "PR", "PE", "PI", "RJ", "RN", "RS", "RO", "RR", "SC", "SP", "SE", "TO"]; document.getElementById('st-estado').innerHTML = ufs.map(u => `<option value="${u}">${u}</option>`).join(''); }
    window.onclick = function(event) { if (event.target.classList.contains('modal')) { event.target.style.display = "none"; } }
    </script>

</body>
</html>
