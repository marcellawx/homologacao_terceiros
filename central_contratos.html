<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prot√≥tipo - Central de Contratos de Terceiros</title>
    <style>
        :root {
            --cor-primaria: #0072C6; --cor-sucesso: #28a745; --cor-perigo: #dc3545;
            --cor-aviso: #FFC107; --cor-info: #6f42c1; --cor-fundo: #F4F7FC;
            --cor-fundo-coluna: #E9ECEF; --cor-texto: #333; --cor-borda: #DEE2E6;
        }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--cor-fundo); margin: 0; padding: 25px; color: var(--cor-texto); }
        h1, h2 { color: var(--cor-primaria); }
        h1 { text-align: center; margin-bottom: 20px; }

        /* --- NOVO: BARRA DE NOTIFICA√á√ÉO --- */
        .notification-bar {
            background-color: var(--cor-aviso);
            color: #333;
            padding: 12px 20px;
            text-align: center;
            font-size: 16px;
            font-weight: bold;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none; /* Inicia escondido */
        }
        .notification-bar a {
            color: var(--cor-primaria);
            text-decoration: underline;
            cursor: pointer;
        }

        /* --- NAVEGA√á√ÉO POR ABAS --- */
        .main-tabs { border-bottom: 2px solid var(--cor-borda); margin-bottom: 25px; text-align: center; }
        .tab-btn { background-color: transparent; border: none; padding: 15px 25px; font-size: 18px; cursor: pointer; color: #555; border-bottom: 4px solid transparent; }
        .tab-btn.active { color: var(--cor-primaria); border-bottom-color: var(--cor-primaria); font-weight: bold; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* --- CONTROLES (PESQUISA E FILTROS) --- */
        .controls-container { display: flex; gap: 15px; margin-bottom: 25px; flex-wrap: wrap; }
        .controls-container input, .controls-container select {
            padding: 10px; border: 1px solid var(--cor-borda); border-radius: 5px; font-size: 16px;
        }
        .controls-container input[type="search"] { flex-grow: 1; }

        /* --- LAYOUT DO KANBAN --- */
        .kanban-board { display: flex; gap: 20px; overflow-x: auto; padding-bottom: 20px; }
        .kanban-column { flex: 1; min-width: 320px; background-color: var(--cor-fundo-coluna); border-radius: 8px; padding: 15px; }
        .kanban-column h2 { font-size: 18px; margin: 0 0 15px 0; padding-bottom: 10px; border-bottom: 2px solid var(--cor-borda); display: flex; justify-content: space-between; align-items: center; }
        .task-count { background-color: #ced4da; color: #495057; border-radius: 12px; padding: 2px 10px; font-size: 14px; }

        /* --- ESTILO DOS CARDS --- */
        .kanban-card { background-color: #FFF; padding: 15px; border-radius: 6px; box-shadow: 0 2px 5px rgba(0,0,0,0.08); border-left: 5px solid; margin-bottom: 15px; }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .card-header h3 { font-size: 16px; margin: 0; }
        .card-header h3 a { color: var(--cor-texto); text-decoration: none; }
        .card-header h3 a:hover { color: var(--cor-primaria); text-decoration: underline; }
        .badge { padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: bold; color: white; }
        .badge.homologacao { background-color: var(--cor-primaria); }
        .badge.reajuste { background-color: var(--cor-aviso); color: #333; }
        .badge.aditivo { background-color: var(--cor-info); }
        .badge.desomologacao { background-color: var(--cor-perigo); }

        .card-body p { font-size: 14px; margin: 5px 0; color: #555; }
        .card-body a { color: var(--cor-primaria); text-decoration: none; font-weight: bold; }
        .card-body a:hover { text-decoration: underline; }

        /* --- CHECKLIST EXPANS√çVEL --- */
        .checklist-container { margin-top: 15px; }
        .checklist-container summary { cursor: pointer; font-weight: bold; color: var(--cor-primaria); font-size: 14px; }
        .checklist { list-style: none; padding: 10px 0 0 5px; margin: 0; }
        .checklist li { font-size: 14px; padding: 8px 0; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #f0f0f0; }
        .checklist li:last-child { border-bottom: none; }
        .task-content { display: flex; align-items: center; }
        .checklist input[type="checkbox"] { margin-right: 10px; flex-shrink: 0; }
        .checklist label.completed { text-decoration: line-through; color: #888; }
        .checklist-date { font-size: 12px; color: #6c757d; font-style: italic; margin-left: 15px; white-space: nowrap; flex-shrink: 0; }
        .card-footer { margin-top: 15px; text-align: right; }
        .btn { padding: 8px 15px; border: none; border-radius: 5px; font-size: 14px; cursor: pointer; color: white; background-color: var(--cor-primaria);}

        /* --- VIS√ÉO DE REAJUSTE --- */
        .reajuste-list { list-style: none; padding: 0; }
        .reajuste-item { display: flex; justify-content: space-between; align-items: center; background: #fff; padding: 20px; border-radius: 6px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .reajuste-info h3 { margin: 0 0 5px 0; font-size: 18px; color: var(--cor-texto); }
        .reajuste-info p { margin: 0; font-size: 14px; color: #555; }
        .reajuste-countdown { text-align: right; }
        .reajuste-countdown .days { font-size: 24px; font-weight: bold; color: var(--cor-primaria); }
        .reajuste-countdown .days.urgent { color: var(--cor-perigo); }
        .reajuste-countdown .label { font-size: 14px; color: #555; }

        /* --- MODAIS --- */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); backdrop-filter: blur(5px); }
        .modal-content { background-color: #fefefe; margin: 5% auto; padding: 30px; border: 1px solid #888; width: 90%; max-width: 800px; border-radius: 8px; box-shadow: 0 5px 20px rgba(0,0,0,0.3); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--cor-borda); padding-bottom: 15px; margin-bottom: 20px; }
        .modal-header h2 { margin: 0; }
        .close-btn { color: #aaa; font-size: 32px; font-weight: bold; cursor: pointer; }

        /* Formul√°rio do Storytelling */
        .storytelling-form { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .form-group { display: flex; flex-direction: column; }
        .form-group.full-width { grid-column: 1 / -1; }
        .form-group label { margin-bottom: 5px; font-weight: bold; font-size: 14px; color: #333; }
        .form-group input, .form-group select, .form-group textarea { padding: 10px; font-size: 16px; border: 1px solid var(--cor-borda); border-radius: 5px; }
        .form-group textarea { min-height: 100px; resize: vertical; }

    </style>
</head>
<body>

    <h1>Central de Contratos de Terceiros</h1>
    
    <div id="notification-bar" class="notification-bar"></div>

    <nav class="main-tabs">
        <button class="tab-btn active" onclick="openTab(event, 'kanban-view')">Kanban de Processos</button>
        <button class="tab-btn" onclick="openTab(event, 'reajuste-view')">Anivers√°rio de Contratos (Reajuste)</button>
    </nav>

    <div id="kanban-view" class="tab-content active">
        <div class="controls-container">
            <input type="search" id="search-input" placeholder="Pesquisar por empresa...">
            <select id="filter-status">
                <option value="">Filtrar por Status</option>
            </select>
            <select id="filter-processo">
                <option value="">Filtrar por Tipo</option>
            </select>
        </div>
        <main class="kanban-board" id="kanban-board"></main>
    </div>

    <div id="reajuste-view" class="tab-content">
        <div class="controls-container">
            <input type="search" id="reajuste-search-input" placeholder="Pesquisar por empresa...">
            <select id="reajuste-sort">
                <option value="asc">Classificar por dias (Crescente)</option>
                <option value="desc">Classificar por dias (Decrescente)</option>
            </select>
            <input type="month" id="reajuste-period-filter">
        </div>
        <ul class="reajuste-list" id="reajuste-list">
        </ul>
    </div>

    <div id="history-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Hist√≥rico do Processo</h2>
                <span class="close-btn" onclick="closeModal('history-modal')">&times;</span>
            </div>
            <ul id="modal-timeline" class="timeline"></ul>
        </div>
    </div>
    <div id="storytelling-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="storytelling-title">Detalhes do Fornecedor</h2>
                <span class="close-btn" onclick="closeModal('storytelling-modal')">&times;</span>
            </div>
            <form class="storytelling-form">
                <div class="form-group"> <label for="st-fornecedor">FORNECEDOR</label> <input type="text" id="st-fornecedor" readonly> </div>
                <div class="form-group"> <label for="st-codigo">C√ìDIGO DO FORNECEDOR (6 d√≠gitos)</label> <input type="number" id="st-codigo"> </div>
                <div class="form-group"> <label for="st-cnpj">CNPJ</label> <input type="text" id="st-cnpj"> </div>
                <div class="form-group"> <label for="st-contato-excecao">NOME DO CONTATO PROPOSTA DE EXCE√á√ÉO</label> <input type="text" id="st-contato-excecao"> </div>
                <div class="form-group"> <label for="st-email-excecao">E-MAIL PARA ASSINATURA PROPOSTA DE EXCE√á√ÉO</label> <input type="email" id="st-email-excecao"> </div>
                <div class="form-group"> <label for="st-telefone">CONTATO TELEFONE (11 d√≠gitos)</label> <input type="tel" id="st-telefone"> </div>
                <div class="form-group"> <label for="st-contatos-demanda">CONTATOS PARA RECEBER DEMANDA</label> <input type="text" id="st-contatos-demanda"> </div>
                <div class="form-group"> <label for="st-telefone-demanda">TELEFONE RESPONS√ÅVEIS DEMANDA (11 d√≠gitos)</label> <input type="tel" id="st-telefone-demanda"> </div>
                <div class="form-group"> <label for="st-receber-demanda">RECEBER DEMANDA?</label> <select id="st-receber-demanda"><option>Sim</option><option>N√£o</option></select> </div>
                <div class="form-group"> <label for="st-tipo-contrato">TIPO DE CONTRATO</label> <input type="text" id="st-tipo-contrato"> </div>
                <div class="form-group"> <label for="st-estado">ESTADO (UF)</label> <select id="st-estado"></select> </div>
                <div class="form-group"> <label for="st-numero-contrato">NUMERO CONTRATO</label> <input type="text" id="st-numero-contrato"> </div>
                <div class="form-group full-width"> <label for="st-contatos-fechamento">CONTATOS PARA RECEBER COMPOSI√á√ÉO DE FECHAMENTO</label> <input type="text" id="st-contatos-fechamento"> </div>
                <div class="form-group"> <label for="st-canal">√â CANAL?</label> <select id="st-canal"><option>Sim</option><option>N√£o</option></select> </div>
                <div class="form-group"> <label for="st-selo">ELEG√çVEL AO SELO?</label> <select id="st-selo"><option>Sim</option><option>N√£o</option></select> </div>
                <div class="form-group"> <label for="st-responsavel-selo">Respons√°vel pelo Selo</label> <input type="text" id="st-responsavel-selo"> </div>
                <div class="form-group"> <label for="st-email-selo">E-mail respons√°vel pelo selo</label> <input type="email" id="st-email-selo"> </div>
                <div class="form-group"> <label for="st-filiais-cxs">CONTRATO COM AS FILIAIS TTS CXS E POA?</label> <select id="st-filiais-cxs"><option>Sim</option><option>N√£o</option></select> </div>
                <div class="form-group"> <label for="st-filiais-ip">CONTRATO COM AS FILIAIS TTS IP?</label> <select id="st-filiais-ip"><option>Sim</option><option>N√£o</option></select> </div>
                <div class="form-group full-width"> <label for="st-area-solicitante">√ÅREA SOLICITANTE</label> <input type="text" id="st-area-solicitante"> </div>
                <div class="form-group full-width"> <label for="st-obs">OBSERVA√á√ÉO</label> <textarea id="st-obs"></textarea> </div>
            </form>
        </div>
    </div>


    <script>
    // --- BANCO DE DADOS FALSO (MOCK) ---
    const mockProcessos = [
        {
            id: 101, empresa: "ACME Solu√ß√µes de TI", processo: "Homologa√ß√£o", tipoContrato: "Consultoria", status: "Pendente An√°lise", ultimaAtualizacao: "2025-10-14", zendeskTicket: 87345,
            dataHomologacao: "2024-10-20",
            storytelling: { codigo: 100201, cnpj: "12.345.678/0001-99", estado: "SP", numeroContrato: "CTR-2024-1020", ehCanal: "N√£o", elegivelSelo: "Sim" },
            checklists: { "Homologa√ß√£o": [
                { tarefa: "BATE PAPO SOBRE HOMOLOGA√á√ÉO COM O FORNECEDOR", concluida: true, dataConclusao: "12/10/2025" },
                { tarefa: "E-mail com documenta√ß√£o para novo contrato de presta√ß√£o de servi√ßos", concluida: true, dataConclusao: "13/10/2025" },
                { tarefa: "Alimentar informa√ß√µes na planilha de Status e Acompanhamento das Homologa√ß√µes - RMO Terceiros", concluida: false, dataConclusao: null },
                { tarefa: "Validar documento assim que receber", concluida: false, dataConclusao: null },
                { tarefa: "Em caso de altera√ß√£o de valor de fun√ß√£o j√° existente enviar comunicado para o solicitante da Homologa√ß√£o validar", concluida: false, dataConclusao: null },
                { tarefa: "Se tiver fun√ß√£o nova, validar com a Unidade que pediu a homologa√ß√£o se o valor est√° dentro do acordado", concluida: false, dataConclusao: null },
                { tarefa: "Aguardando aprova√ß√£o dos valores e ou inclus√£o de mais fun√ß√£o", concluida: false, dataConclusao: null },
                { tarefa: "Enviar e-mail para CST Contratos com Formul√°rio, aprova√ß√£o do gerente e documenta√ß√£o da empresa", concluida: false, dataConclusao: null },
                { tarefa: "Validar no Protheus se contrato foi finalizado (cadastrado) gerar relat√≥rio", concluida: false, dataConclusao: null },
                { tarefa: "Colocar as informa√ß√µes em nossa planilha na aba Fornecedores e na aba VALOR HORA", concluida: false, dataConclusao: null },
                { tarefa: "Colocar informa√ß√£o do Fornecedor no Fluig para Proposta de exce√ß√£o", concluida: false, dataConclusao: null },
                { tarefa: "Enviar e-mail de Boas Vindas", concluida: false, dataConclusao: null },
                { tarefa: "Solicitar para a √°rea de CST PMO Local, abrir ticket para cadastro de contrato do fornecedor no Horacius", concluida: false, dataConclusao: null },
                { tarefa: "Bate papo Onboarding", concluida: false, dataConclusao: null },
                { tarefa: "Coloca informa√ß√£o na planilha de Status e Acompanhamento das Homologa√ß√µes.", concluida: false, dataConclusao: null },
                { tarefa: "Responder ticket do Zendesk finalizando o processo e avisando a √°rea.", concluida: false, dataConclusao: null },
                { tarefa: "Confirmar se preencheram formul√°rio para receber o selo", concluida: false, dataConclusao: null },
                { tarefa: "Disponibilizar o selo partners para fornecedores SELIND", concluida: false, dataConclusao: null }
            ]},
            historico: [ { data: "2025-10-14", evento: "Fornecedor agendou reuni√£o inicial." } ]
        },
        {
            id: 102, empresa: "Nexus Inova√ß√µes", processo: "Reajuste", tipoContrato: "Presta√ß√£o de Servi√ßos", status: "Em Andamento", ultimaAtualizacao: "2025-10-15", zendeskTicket: 22518,
            dataHomologacao: "2024-12-05",
            storytelling: { codigo: 100315, cnpj: "98.765.432/0001-11", estado: "RJ", numeroContrato: "CTR-2023-0874", ehCanal: "Sim", elegivelSelo: "Sim" },
            checklists: { "Reajuste": [ { tarefa: "Receber solicita√ß√£o de reajuste", concluida: true, dataConclusao: "12/10/2025" } ] },
            historico: [ { data: "2025-10-15", evento: "An√°lise do √≠ndice contratual conclu√≠da." } ]
        },
        {
            id: 103, empresa: "Quantum Tech", processo: "Homologa√ß√£o", tipoContrato: "Consultoria", status: "Aguardando Terceiros", ultimaAtualizacao: "2025-10-10", zendeskTicket: 91023,
            dataHomologacao: "2025-08-01",
            storytelling: { codigo: 100450, cnpj: "55.444.333/0001-22", estado: "MG", numeroContrato: "CTR-2025-1130", ehCanal: "N√£o", elegivelSelo: "N√£o" },
            checklists: { "Homologa√ß√£o": [ { tarefa: "Validar documento assim que receber", concluida: false, dataConclusao: null } ] },
            historico: [ { data: "2025-10-10", evento: "Pend√™ncias na documenta√ß√£o enviadas ao fornecedor." } ]
        },
        {
            id: 104, empresa: "Orion Solu√ß√µes", processo: "Aditivo", tipoContrato: "Consultoria", status: "Pendente An√°lise", ultimaAtualizacao: "2025-10-12", zendeskTicket: 34567,
            dataHomologacao: "2023-01-15",
            storytelling: { codigo: 100500, cnpj: "66.777.888/0001-99", estado: "BA", numeroContrato: "CTR-2023-0050", ehCanal: "N√£o", elegivelSelo: "Sim" },
            checklists: { "Aditivo": [ { tarefa: "Analisar escopo e cl√°usulas", concluida: false, dataConclusao: null } ] },
            historico: [ { data: "2025-10-12", evento: "Recebida solicita√ß√£o de aditivo para incluir novo servi√ßo." } ]
        },
        {
            id: 105, empresa: "LogiSystem", processo: "Desomologa√ß√£o", tipoContrato: "Consultoria", status: "Conclu√≠do", ultimaAtualizacao: "2025-09-30", zendeskTicket: 48859,
            dataHomologacao: "2022-05-20",
            storytelling: { codigo: 100112, cnpj: "11.222.333/0001-44", estado: "PR", numeroContrato: "CTR-2022-0412", ehCanal: "N√£o", elegivelSelo: "Sim" },
            checklists: { "Desomologa√ß√£o": [ { tarefa: "Formalizar distrato", concluida: true, dataConclusao: "30/09/2025" } ]},
            historico: [ { data: "2025-09-30", evento: "Processo de desomologa√ß√£o finalizado." }]
        }
    ];

    // --- L√ìGICA GERAL DA P√ÅGINA ---
    document.addEventListener('DOMContentLoaded', () => {
        populateFilters();
        populateUfSelect();
        renderKanbanView();
        
        // Listeners do Kanban
        document.getElementById('search-input').addEventListener('input', renderKanbanView);
        document.getElementById('filter-status').addEventListener('change', renderKanbanView);
        document.getElementById('filter-processo').addEventListener('change', renderKanbanView);
        
        // Listeners da Aba Reajuste
        document.getElementById('reajuste-search-input').addEventListener('input', renderReajusteView);
        document.getElementById('reajuste-sort').addEventListener('change', renderReajusteView);
        document.getElementById('reajuste-period-filter').addEventListener('change', renderReajusteView);
    });

    // --- L√ìGICA DAS ABAS ---
    function openTab(evt, tabName) {
        document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById(tabName).classList.add('active');
        evt.currentTarget.classList.add('active');

        if (tabName === 'reajuste-view') {
            renderReajusteView();
        }
    }
    
    // --- NOVO: L√ìGICA DA NOTIFICA√á√ÉO ---
    function updateNotification() {
        const notificationBar = document.getElementById('notification-bar');
        const pendingCount = mockProcessos.filter(p => p.status === 'Pendente An√°lise').length;
        
        if (pendingCount > 0) {
            notificationBar.innerHTML = `üîî Voc√™ tem ${pendingCount} ${pendingCount > 1 ? 'pend√™ncias' : 'pend√™ncia'} na coluna <a onclick="focusPending()">"Pendente An√°lise"</a>.`;
            notificationBar.style.display = 'block';
        } else {
            notificationBar.style.display = 'none';
        }
    }
    
    function focusPending() {
        // Leva o usu√°rio para a aba do Kanban
        openTab({ currentTarget: document.querySelector('.tab-btn[onclick*="kanban-view"]') }, 'kanban-view');
        
        // For√ßa o filtro para "Pendente An√°lise"
        document.getElementById('filter-status').value = 'Pendente An√°lise';
        renderKanbanView();
        
        // Anima√ß√£o de destaque na coluna
        const pendingColumn = document.getElementById('col-pendente');
        if(pendingColumn) {
            pendingColumn.style.transition = 'all 0.3s ease';
            pendingColumn.style.backgroundColor = '#FFF3CD';
            setTimeout(() => {
                pendingColumn.style.backgroundColor = ''; // Volta √† cor original
            }, 1500);
        }
    }

    // --- L√ìGICA DO KANBAN ---
    const colunas = {
        "Pendente An√°lise": { id: "col-pendente", titulo: "Pendente An√°lise" }, "Em Andamento": { id: "col-andamento", titulo: "Em Andamento" },
        "Aguardando Terceiros": { id: "col-aguardando", titulo: "Aguardando Terceiros" }, "Conclu√≠do": { id: "col-concluido", titulo: "Conclu√≠do" }
    };

    function populateFilters() {
        const statusSet = new Set(mockProcessos.map(p => p.status));
        const processoSet = new Set(mockProcessos.map(p => p.processo));
        const statusFilter = document.getElementById('filter-status');
        const processoFilter = document.getElementById('filter-processo');
        statusSet.forEach(s => statusFilter.innerHTML += `<option value="${s}">${s}</option>`);
        processoSet.forEach(p => processoFilter.innerHTML += `<option value="${p}">${p}</option>`);
    }

    function renderKanbanView() {
        updateNotification(); // Atualiza a notifica√ß√£o sempre que o Kanban for renderizado
        const board = document.getElementById('kanban-board');
        board.innerHTML = '';

        const searchTerm = document.getElementById('search-input').value.toLowerCase();
        const statusFilter = document.getElementById('filter-status').value;
        const processoFilter = document.getElementById('filter-processo').value;

        const filteredProcessos = mockProcessos.filter(p => {
            const matchesSearch = p.empresa.toLowerCase().includes(searchTerm);
            const matchesStatus = !statusFilter || p.status === statusFilter;
            const matchesProcesso = !processoFilter || p.processo === processoFilter;
            return matchesSearch && matchesStatus && matchesProcesso;
        });

        for (const status in colunas) {
            const colunaInfo = colunas[status];
            const count = filteredProcessos.filter(p => p.status === status).length;
            board.innerHTML += `<div class="kanban-column" id="${colunaInfo.id}"><h2 >${colunaInfo.titulo} <span class="task-count">${count}</span></h2></div>`;
        }
        
        filteredProcessos.forEach(processo => {
            const colunaEl = document.getElementById(colunas[processo.status].id);
            if (colunaEl) colunaEl.innerHTML += createCardHtml(processo);
        });
        
        addChecklistListeners();
    }

    function createCardHtml(processo) {
        // CORRIGIDO: Slug para "desomologa√ß√£o"
        const processoSlug = processo.processo.toLowerCase().replace(/√ß/g, 'c').replace(/√£/g, 'a');
        const checklist = processo.checklists[processo.processo] || [];
        
        let checklistHtml = checklist.map((item, index) => {
            const dataConclusao = item.concluida && item.dataConclusao ? item.dataConclusao : '';
            return `
                <li>
                    <div class="task-content">
                        <input type="checkbox" id="task-${processo.id}-${index}" data-processo-id="${processo.id}" data-task-index="${index}" ${item.concluida ? 'checked' : ''}>
                        <label for="task-${processo.id}-${index}" class="${item.concluida ? 'completed' : ''}">${item.tarefa}</label>
                    </div>
                    <small class="checklist-date">${dataConclusao}</small>
                </li>
            `;
        }).join('');

        return `
            <div class="kanban-card" style="border-left-color: var(--cor-${processoSlug === 'reajuste' ? 'aviso' : processoSlug === 'aditivo' ? 'info' : processoSlug === 'desomologacao' ? 'perigo' : 'primaria'});">
                <div class="card-header">
                    <h3><a href="#" onclick="event.preventDefault(); openStorytellingModal(${processo.id})">${processo.empresa}</a></h3>
                    <span class="badge ${processoSlug}">${processo.processo}</span>
                </div>
                <div class="card-body">
                    <p><strong>Zendesk:</strong> <a href="#" target="_blank">Ticket #${processo.zendeskTicket}</a></p>
                    <p><strong>√öltima Atividade:</strong> ${new Date(processo.ultimaAtualizacao + 'T12:00:00Z').toLocaleDateString('pt-BR')}</p>
                </div>
                <details class="checklist-container">
                    <summary>Ver Checklist de Afazeres</summary>
                    <ul class="checklist">${checklistHtml}</ul>
                </details>
                <div class="card-footer">
                    <button class="btn" onclick="openHistoryModal(${processo.id})">Ver Hist√≥rico</button>
                </div>
            </div>
        `;
    }

    // --- L√ìGICA DA ABA DE REAJUSTE ---
    function renderReajusteView() {
        const listEl = document.getElementById('reajuste-list');
        listEl.innerHTML = '';
        const hoje = new Date();
        
        const searchTerm = document.getElementById('reajuste-search-input').value.toLowerCase();
        const sortOrder = document.getElementById('reajuste-sort').value;
        const periodFilter = document.getElementById('reajuste-period-filter').value; // Formato YYYY-MM

        let fornecedores = mockProcessos
            .filter(p => p.dataHomologacao)
            .map(p => {
                const dataHomologacao = new Date(p.dataHomologacao + 'T12:00:00Z');
                let proximoAniversario = new Date(dataHomologacao);
                proximoAniversario.setFullYear(hoje.getFullYear());
                if (proximoAniversario < hoje) {
                    proximoAniversario.setFullYear(hoje.getFullYear() + 1);
                }
                const diffTime = proximoAniversario - hoje;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                return { ...p, proximoAniversario, diffDays };
            })
            .filter(p => {
                const matchesSearch = p.empresa.toLowerCase().includes(searchTerm);
                let matchesPeriod = true;
                if (periodFilter) {
                    const [year, month] = periodFilter.split('-');
                    matchesPeriod = p.proximoAniversario.getFullYear() == year && (p.proximoAniversario.getMonth() + 1) == month;
                }
                return matchesSearch && matchesPeriod;
            });

        fornecedores.sort((a, b) => {
            return sortOrder === 'asc' ? a.diffDays - b.diffDays : b.diffDays - a.diffDays;
        });

        fornecedores.forEach(p => {
            const urgentClass = p.diffDays <= 30 ? 'urgent' : '';
            listEl.innerHTML += `
                <li class="reajuste-item">
                    <div class="reajuste-info">
                        <h3>${p.empresa}</h3>
                        <p>Data de Homologa√ß√£o: ${new Date(p.dataHomologacao + 'T12:00:00Z').toLocaleDateString('pt-BR')} | Pr√≥ximo Anivers√°rio: ${p.proximoAniversario.toLocaleDateString('pt-BR')}</p>
                    </div>
                    <div class="reajuste-countdown">
                        <div class="days ${urgentClass}">${p.diffDays}</div>
                        <div class="label">dias restantes</div>
                    </div>
                </li>
            `;
        });
    }

    // --- L√ìGICA DOS MODAIS E INTERATIVIDADE ---
    // ... (As fun√ß√µes openHistoryModal, openStorytellingModal, closeModal, etc. continuam id√™nticas) ...
    function openHistoryModal(processoId) {
        const processo = mockProcessos.find(p => p.id === processoId);
        if (processo) {
            document.getElementById('modal-title').textContent = `Hist√≥rico: ${processo.empresa}`;
            document.getElementById('modal-timeline').innerHTML = processo.historico.map(item => `<li><span class="date">${new Date(item.data + 'T12:00:00Z').toLocaleDateString('pt-BR')}</span><p>${item.evento}</p></li>`).join('');
            document.getElementById('history-modal').style.display = 'block';
        }
    }
    function openStorytellingModal(processoId) {
        const processo = mockProcessos.find(p => p.id === processoId);
        if (!processo || !processo.storytelling) return;
        const s = processo.storytelling;
        document.getElementById('storytelling-title').textContent = `Detalhes de ${processo.empresa}`;
        document.getElementById('st-fornecedor').value = processo.empresa || '';
        document.getElementById('st-codigo').value = s.codigo || '';
        document.getElementById('st-cnpj').value = s.cnpj || '';
        document.getElementById('st-contato-excecao').value = s.contatoExcecao || '';
        document.getElementById('st-email-excecao').value = s.emailExcecao || '';
        document.getElementById('st-telefone').value = s.telefone || '';
        document.getElementById('st-contatos-demanda').value = s.contatosDemanda || '';
        document.getElementById('st-telefone-demanda').value = s.telefoneDemanda || '';
        document.getElementById('st-receber-demanda').value = s.receberDemanda || 'N√£o';
        document.getElementById('st-tipo-contrato').value = processo.tipoContrato || '';
        document.getElementById('st-estado').value = s.estado || '';
        document.getElementById('st-numero-contrato').value = s.numeroContrato || '';
        document.getElementById('st-contatos-fechamento').value = s.contatosFechamento || '';
        document.getElementById('st-canal').value = s.ehCanal || 'N√£o';
        document.getElementById('st-selo').value = s.elegivelSelo || 'N√£o';
        document.getElementById('st-responsavel-selo').value = s.responsavelSelo || '';
        document.getElementById('st-email-selo').value = s.emailSelo || '';
        document.getElementById('st-obs').value = s.obs || '';
        document.getElementById('st-filiais-cxs').value = s.filiaisCxs || 'N√£o';
        document.getElementById('st-filiais-ip').value = s.filiaisIp || 'N√£o';
        document.getElementById('st-area-solicitante').value = s.areaSolicitante || '';
        document.getElementById('storytelling-modal').style.display = 'block';
    }
    function closeModal(modalId) { document.getElementById(modalId).style.display = 'none'; }
    function addChecklistListeners() {
        document.querySelectorAll('.checklist input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const label = this.closest('li').querySelector('label');
                const dateEl = this.closest('li').querySelector('.checklist-date');
                const processoId = parseInt(this.dataset.processoId);
                const taskIndex = parseInt(this.dataset.taskIndex);
                const processo = mockProcessos.find(p => p.id === processoId);
                if (!processo) return;
                const tarefa = processo.checklists[processo.processo][taskIndex];
                if (this.checked) {
                    const hoje = new Date().toLocaleDateString('pt-BR');
                    tarefa.concluida = true;
                    tarefa.dataConclusao = hoje;
                    label.classList.add('completed');
                    dateEl.textContent = hoje;
                } else {
                    tarefa.concluida = false;
                    tarefa.dataConclusao = null;
                    label.classList.remove('completed');
                    dateEl.textContent = '';
                }
            });
        });
    }
    function populateUfSelect() {
        const ufs = ["AC", "AL", "AP", "AM", "BA", "CE", "DF", "ES", "GO", "MA", "MT", "MS", "MG", "PA", "PB", "PR", "PE", "PI", "RJ", "RN", "RS", "RO", "RR", "SC", "SP", "SE", "TO"];
        const select = document.getElementById('st-estado');
        ufs.forEach(uf => select.innerHTML += `<option value="${uf}">${uf}</option>`);
    }
    window.onclick = function(event) { if (event.target.classList.contains('modal')) { event.target.style.display = "none"; } }
    </script>

</body>
</html>
